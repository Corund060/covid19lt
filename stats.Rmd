---
title: "COVID-19 statistika"
output: distill::distill_article
---

```{r, echo=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
library(tidyr)
tt <- read_csv("total/lt-covid19-total.csv") 
```

```{r include = FALSE}
data <- Sys.time()
```

Atnaujinta: `r data`. 


```{r, echo = FALSE}
stt <- tt %>% select(day, confirmed, deaths, recovered) %>% pivot_longer(confirmed:recovered, "type")
ggplot(aes(x = day, y = value, group = type, colour = type), data =stt) + geom_point()+geom_line()+labs(title = paste("Cumulative cases:",max(tt$day))) + scale_color_manual(values = c("confirmed" = "red", "recovered" = "springgreen", deaths = "black"))
```

```{r, echo = FALSE}
ag <- function(x)c(x[1],diff(x))
ntt <- stt %>% arrange(type, day) %>% group_by(type) %>%  mutate(value = ag(value)) %>% ungroup
ggplot(aes(x = day, y = value, group = type), data =ntt) + geom_col(aes(fill=type),position = "dodge",)+labs(title = paste("New cases:",max(tt$day))) + scale_fill_manual(values = c("confirmed" = "red", "recovered" = "springgreen", deaths = "black"))
```


```{r, echo = FALSE}
ggplot(aes(x = day, y = tested), data = tt) +geom_point() + geom_line() + labs(title = paste("Cumulative tests:",max(tt$day)),  x = "tested")
```


```{r, echo = FALSE}
library(lubridate)
labs <- read.csv("tests/lt-covid19-laboratory-total.csv", stringsAsFactors = FALSE) %>% mutate(day = ymd(day))

lbt <- labs %>% group_by(day) %>% summarise(daily_tests = sum(tested_all))
ltt <- tt %>% mutate(daily_tests = ag(tested)) %>% select(day, daily_tests)

lct <- ltt %>% left_join(lbt %>% rename(laboratory_tests = daily_tests), by = "day") %>% 
    mutate(sam_daily_tests = daily_tests, 
           daily_tests = ifelse(is.na(laboratory_tests), sam_daily_tests, laboratory_tests)) 
    

ggplot(aes(x = day, y = daily_tests), data = lct) +geom_col() + labs(title = paste("Daily tests: ", max(tt$day)), y="tested")
```

```{r}
tpd <- tt %>% select(day, confirmed) %>% left_join(lct, by = "day") %>% 
    mutate(incidence = ag(confirmed), normalized = incidence*1000/daily_tests, percent = incidence/daily_tests*100)
ggplot(aes(x = day, y = normalized), data = tpd) +geom_point() + geom_line() + labs(title = paste("Confirmed daily cases per 1000 tests", max(tt$day)),  y = "")

```



```{r, echo = FALSE, fig.height=10, fig.width=10}


labst <- labs %>% select(day, laboratory, tested_all, positive_all, not_tested) %>% pivot_longer(tested_all:not_tested, "type")


ggplot(aes(x = day, y = value, group = type), data = labst) + geom_col(aes(fill=type),position = "dodge")+ facet_wrap(~laboratory, scales = "free_y")+labs(title = paste("Laboratory tests:",max(labs$day)))
```

Laboratorijos pajėgumas tai istorinis laboratorijoje darytų testų maksimumas. Grafike vaizduojamas kiek kurią dieną laboratorijos išnaudoja savo pajėgumus procentais.


```{r}
labs <- labs %>% group_by(laboratory) %>% mutate(tested_all = ifelse(is.na(tested_all), 0, tested_all), capacity= 100*(tested_all/max(tested_all)))

ggplot(aes(x = day, y = capacity, group = laboratory) , data = labs) + geom_col(aes(fill=laboratory),position = "dodge")+ labs(title = paste("Laboratory capacity:",max(labs$day)))
```


Visų laboratorijų pajėgumai yra kiekvienos laboratorijos pajėgumų suma. Grafike vaizduojama kiek visos laboratorijos kartu išnaudoja savo pajėgumus procentais.


```{r, echo = FALSE}

totc <- labs %>% group_by(laboratory) %>% summarize(m = max(tested_all)) %>% .$m %>% sum
daily <- labs %>% group_by(day) %>% summarise(all = sum(tested_all)) %>% ungroup %>% mutate(capacity = 100*all/totc)

ggplot(aes(x = day, y = capacity) , data = daily) + geom_line() + geom_point()+labs(title = paste("Total capacity:",max(labs$day)))
```

